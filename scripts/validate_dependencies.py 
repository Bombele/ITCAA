#!/usr/bin/env python3
"""
validate_dependencies.py
VÃ©rifie la cohÃ©rence des dÃ©pendances Python installÃ©es avec requirements.txt et requirements-dev.txt.
Institutionnalisation pour CI/CD ITCAA.
"""

import sys
import pkg_resources

def log(msg: str):
    print(f"ğŸ” [validate-deps] {msg}", flush=True)

def validate_requirements(file: str) -> bool:
    """Valide les dÃ©pendances par rapport Ã  un fichier requirements."""
    try:
        with open(file, "r", encoding="utf-8") as f:
            requirements = [line.strip() for line in f if line.strip() and not line.startswith("#")]
        pkg_resources.require(requirements)
        log(f"âœ… DÃ©pendances cohÃ©rentes avec {file}")
        return True
    except Exception as e:
        log(f"âŒ IncohÃ©rence dÃ©tectÃ©e dans {file} â†’ {e}")
        return False

def main():
    log("DÃ©marrage de la validation des dÃ©pendances Pythonâ€¦")
    ok = True
    for req_file in ["requirements.txt", "requirements-dev.txt"]:
        try:
            if not validate_requirements(req_file):
                ok = False
        except FileNotFoundError:
            log(f"âš ï¸ Fichier {req_file} introuvable, validation ignorÃ©e.")
    if ok:
        log("ğŸ¯ Toutes les dÃ©pendances sont cohÃ©rentes.")
        sys.exit(0)
    else:
        log("ğŸš« DÃ©pendances incohÃ©rentes. Corrige avant CI/CD.")
        sys.exit(1)

if __name__ == "__main__":
    main()